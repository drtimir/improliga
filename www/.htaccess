RewriteEngine On
RewriteBase /

# Catch icons
RewriteRule ^share/icons/(([a-zA-Z0-9\-\_]*)/)?([0-9]{1,4})/([a-zA-Z0-9\-]*)/([a-zA-Z0-9\-_]*)/([a-zA-Z0-9\-_]*) lib/common/icon.php?theme=$4&size=$3&catg=$5&name=$6 [L]

# Catch other resources
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^share/([a-zA-Z]+)/([0-9a-zA-Z\.\-;_=:\/]*)$ lib/common/$1.php?modules=$2 [L]

# Catch status page
RewriteRule ^status\/?$ lib/common/status.php [L]

# Add trailing slash to the end
RewriteCond %{REQUEST_URI} ^.+$
RewriteCond %{REQUEST_URI} [^/]$
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule (.*) /$1\/ [R=301,L]

# Pass request to YaCMS
RewriteRule ^god/ /godmode.php [L,QSA]

# Deny access to sensitive dirs
RewriteRule ^(bin|etc|(lib(?!/common))|(var/(backups|cache|log))) ./index.php [QSA]

# Pass request to YaWF
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L,QSA]
